'use client';

import * as React from 'react';
import { savePitch, getPitches } from '@/lib/storage';
import type { PitchInput } from '@/types/pitch';

const SEEDS: PitchInput[] = [
  {
    title: 'Dream Home',
    address1: '12 Oak Ln',
    city: 'Moorestown',
    state: 'NJ',
    postalCode: '08057',
    heroImageUrl:
      'https://images.unsplash.com/photo-1560518883-ce09059eeffa?q=80&w=1200&auto=format&fit=crop',

    price: 420_000,
    valuation: 420_000,
    referenceValuation: 400_000,
    minimumInvestment: 5_000,
    fundingGoal: 60_000,
    fundingCommitted: 0,
    appreciationSharePct: 20,
    horizonYears: 5,
    buybackAllowed: true,

    summary:
      'Family starter home in a great school district with moderate upside through cosmetic updates.',
  },
  {
    title: 'Sunset Bungalow',
    address1: '88 Sunset Ave',
    city: 'St. Petersburg',
    state: 'FL',
    postalCode: '33701',
    heroImageUrl:
      'https://images.unsplash.com/photo-1600585153490-76fb20a32601?q=80&w=1200&auto=format&fit=crop',
    valuation: 360_000,
    referenceValuation: 345_000,
    minimumInvestment: 2_500,
    fundingGoal: 40_000,
    fundingCommitted: 5_000,
    appreciationSharePct: 18,
    horizonYears: 4,
    buybackAllowed: true,
    summary:
      'Coastal bungalow near downtown; upside from STR permitting and landscaping.',
  },
  {
    title: 'North Park Craftsman',
    address1: '4517 Oregon St',
    city: 'San Diego',
    state: 'CA',
    postalCode: '92104',
    heroImageUrl:
      'https://images.unsplash.com/photo-1564013799919-ab600027ffc6?q=80&w=1200&auto=format&fit=crop',
    valuation: 895_000,
    referenceValuation: 870_000,
    minimumInvestment: 10_000,
    fundingGoal: 150_000,
    fundingCommitted: 25_000,
    appreciationSharePct: 22,
    horizonYears: 6,
    buybackAllowed: false,
    summary:
      'Classic Craftsman; value-add kitchen + bath refresh. Strong long-term appreciation market.',
  },
  {
    title: 'Maple Street Flip',
    address1: '319 Maple St',
    city: 'Columbus',
    state: 'OH',
    postalCode: '43215',
    heroImageUrl:
      'https://images.unsplash.com/photo-1600585154526-990dced4df5f?q=80&w=1200&auto=format&fit=crop',
    valuation: 235_000,
    referenceValuation: 210_000,
    minimumInvestment: 1_000,
    fundingGoal: 30_000,
    fundingCommitted: 2_000,
    appreciationSharePct: 25,
    horizonYears: 2,
    buybackAllowed: false,
    summary:
      'Light rehab flip (paint/flooring/exterior trim). Short horizon; upside targeted on resale.',
  },
  {
    title: 'Community Rescue – The Johnsons',
    address1: '17 Birch Rd',
    city: 'Raleigh',
    state: 'NC',
    postalCode: '27603',
    heroImageUrl:
      'https://images.unsplash.com/photo-1600585154154-1cde37f4f9f9?q=80&w=1200&auto=format&fit=crop',
    valuation: 310_000,
    referenceValuation: 300_000,
    minimumInvestment: 500,
    fundingGoal: 25_000,
    fundingCommitted: 12_000,
    appreciationSharePct: 15,
    horizonYears: 7,
    buybackAllowed: true,
    summary:
      '“Feel-good” rescue: help a family avoid displacement via shared-equity; modest appreciation.',
  },
];

export default function SeedPage() {
  const [count, setCount] = React.useState(0);
  const [busy, setBusy] = React.useState(false);
  const [msg, setMsg] = React.useState('');

  React.useEffect(() => {
    getPitches().then((ps) => setCount(ps.length));
  }, []);

  const seed = async () => {
    setBusy(true);
    setMsg('');
    try {
      const existing = await getPitches();
      const keys = new Set(
        existing.map((p) => `${p.title}|${p.address1 ?? ''}|${p.postalCode ?? p.zip ?? ''}`)
      );

      let created = 0;
      for (const row of SEEDS) {
        const key = `${row.title}|${row.address1 ?? ''}|${row.postalCode ?? row.zip ?? ''}`;
        if (!keys.has(key)) {
          await savePitch(row);
          created += 1;
        }
      }

      const all = await getPitches();
      setCount(all.length);
      setMsg(`Seed complete. Added ${created} new listing${created === 1 ? '' : 's'}.`);
    } finally {
      setBusy(false);
    }
  };

  return (
    <div className="mx-auto max-w-3xl p-6">
      <h1 className="text-2xl font-semibold mb-2">Seed demo listings</h1>
      <p className="mb-6 text-sm text-gray-600">
        These samples live in your browser’s local storage for quick demos and development.
      </p>

      <div className="flex items-center gap-3">
        <button
          onClick={seed}
          disabled={busy}
          className="rounded-md bg-blue-600 px-4 py-2 text-white hover:bg-blue-700 disabled:opacity-50"
        >
          {busy ? 'Seeding…' : 'Seed now'}
        </button>
        <span className="text-sm text-gray-700">Current listings: {count}</span>
      </div>

      {msg && <p className="mt-4 text-green-700">{msg}</p>}
    </div>
  );
}
